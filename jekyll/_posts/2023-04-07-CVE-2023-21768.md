---
title: Windows 11 22H2 CVE-2023-21768 afd.sys LPE
published: false
tags: [ "kernelexploitation", "windows", "lab", "CVE-2023-21768" ]
image: assets/previews/20.jpg
layout: page
pagination: 
  enabled: true
---

### [](#header-3) Links

[exploit by chompie](https://github.com/chompie1337/Windows_LPE_AFD_CVE-2023-21768)

[write-up by h1bAna](https://github.com/h1bAna/CVE-2023-21768)

[anotehr write-up](https://securityintelligence.com/posts/patch-tuesday-exploit-wednesday-pwning-windows-ancillary-function-driver-winsock)

[I/O Rings – When One I/O Operation is Not Enough](https://windows-internals.com/i-o-rings-when-one-i-o-operation-is-not-enough)

[One Year to I/O Ring: What Changed?](https://windows-internals.com/one-year-to-i-o-ring-what-changed)

[One I/O Ring to Rule Them All: A Full Read/Write Exploit Primitive on Windows 11](https://windows-internals.com/one-i-o-ring-to-rule-them-all-a-full-read-write-exploit-primitive-on-windows-11)


I'll take main info from each article useful for the research.

### [](#header-3) [ May 24 2021 ] I/O Rings – When One I/O Operation is Not Enough

[Circular buffer](https://en.wikipedia.org/wiki/Circular_buffer)

New thing is just a circular buffer structure for queue multiple I/O operations at one moment and to allow user-mode applications performing a lot of I/O operations to do so in one action instead of transitioning from user to kernel and back for every individual request

Currently - only read operations, queue up to 0x10000 operations at a time

NtCreateIoRing - initialize I/O ring

```cpp
typedef struct _IORING_OBJECT
{
  USHORT Type;
  USHORT Size;
  NT_IORING_INFO Info;
  PSECTION SectionObject;
  PVOID KernelMappedBase;
  PMDL Mdl;
  PVOID MdlMappedBase;
  ULONG_PTR ViewSize;
  ULONG SubmitInProgress;
  PVOID IoRingEntryLock;
  PVOID EntriesCompleted;
  PVOID EntriesSubmitted;
  KEVENT RingEvent;
  PVOID EntriesPending;
  ULONG BuffersRegistered;
  PIORING_BUFFER_INFO BufferArray;
  ULONG FilesRegistered;
  PHANDLE FileHandleArray;
} IORING_OBJECT, *PIORING_OBJECT;
```

### [](#header-3) [ April 29 2022 ] One Year to I/O Ring: What Changed?

### [](#header-3) [ July 5 2022 ] One I/O Ring to Rule Them All: A Full Read/Write Exploit Primitive on Windows 11